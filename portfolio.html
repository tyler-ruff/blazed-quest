<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="dns-prefetch" href="//blazed.sirv.com/">
    <link rel="preconnect" href="https://blazed.sirv.com/">
    <!-- BLZ-FIRE -->
    <script src="lib/fire.js"></script>
    <link href="lib/fire.css" rel="stylesheet" />
    <!-- Site Config -->
    <script src="assets/js/site.blz.js"></script>
    <script src="assets/js/views/portfolio.blz.js"></script>
    <!-- styles -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="assets/css/docs.css" rel="stylesheet">
    <link href="assets/css/prettyPhoto.css" rel="stylesheet">
    <link href="assets/js/google-code-prettify/prettify.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300|Open+Sans:400,300,300italic,400italic" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/color/success.css" rel="stylesheet">
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js";
      import { getFirestore, collection, getDocs, query, startAfter, limit, orderBy, where } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-firestore.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      let params = new Proxy(new URLSearchParams(window.location.search), {
          get: (searchParams, prop) => searchParams.get(prop),
      });
      let pPage = params.p;

      let lastItem = [];
      let maxUnits = 0;

      if(pPage === null){
        const portfolioId = params.id;
        if(portfolioId === null){
            window.location.replace("https://blazed.quest/portfolio.html?p=websites");
        }
      }
      
      async function getWebsites(db){

      }

      async function getSoftware(db){

      }

      async function getMedia(db){

      }

      async function getProjects(db, targetPage = null){
        const projectsCol = collection(db, 'projects');

        //Get Total Count
        const qry = query(projectsCol);
        const snapshot = await getDocs(qry);
        const count = snapshot.size;

        let currentPage = 1;
        let q = null;
        let lastItem = [];
        const pageNum = document.getElementById('page-num');
        if(targetPage !== null){
          currentPage = parseInt(document.getElementById('page-num').innerHTML);
          lastItem[targetPage] = document.getElementById('last-item').innerHTML;
          q = query(projectsCol, limit(9), orderBy('name', 'asc'), startAfter(lastItem[targetPage]));
        } else {
          q = query(projectsCol, orderBy('name', 'asc'), limit(9));
        }

        if((currentPage >= Math.ceil(count / 8))){
          document.getElementById('portfolio-info').innerHTML = `Viewing: ${Math.floor(count / 8) + 8} of ${count-1} Projects.`;
        }
        else {
          document.getElementById('portfolio-info').innerHTML = `Viewing: ${currentPage*8} of ${count-1} Projects.`;
        }

        if(q !== null){
          const snapshot = await getDocs(q);
          const projectsList = snapshot.docs.map(doc => doc.data());
          document.getElementById('portfolio-inner').innerHTML = ``;
          if(projectsList.length >= 1){
            for(let i = 0; i < (projectsList.length-1); i++){
              document.getElementById('portfolio-inner').innerHTML += `
                <li class="portfolio-item2" data-id="id-${i}" data-type="web">
                  <div class="span3">
                    <div class="thumbnail">
                      <div class="image-wrapp">
                        <img src="${projectsList[i].image}?w=300&h=300" alt="Portfolio Project" title="${projectsList[i].name}" />
                        <article class="da-animate da-slideFromRight" style="display: block;">
                          <a class="link_post" href="${projectsList[i].url}"><span class="fa fa-link"></span></a>
                          <span><a class="zoom" href="https://blazed.quest/portfolio.html?p=project&id=${projectsList[i].id}"><span class="fa fa-eye"></span></a></span>
                        </article>
                      </div>
                      <div class="caption">
                        <h4><a href="${projectsList[i].url}">${projectsList[i].name}</a></h4>
                        <p>${projectsList[i].desc}</p>
                      </div>
                    </div>
                  </div>
                </li>
              `;
              if(i === (projectsList.length-2)){
                const lastItem = projectsList[projectsList.length-2].name;
                const lastItemVar = f('span');
                lastItemVar.id = "last-item";
                lastItemVar.classList.add("hidden-var");
                lastItemVar.innerHTML = `${lastItem}`;
                document.getElementById('pagination-wrapper').appendChild(lastItemVar);
              }
            }
            const pageVar = f('span');
            pageVar.id = "page-num";
            pageVar.classList.add("hidden-var");
            pageVar.innerHTML = `${currentPage}`;
            document.getElementById('pagination-wrapper').appendChild(pageVar);
            document.getElementById('pagination-bottom').innerHTML = ``;
            if(currentPage > 1){
              document.getElementById('pagination-bottom').innerHTML += `
                <li>
                  <a class="pagination-btn" id="prev-page">Previous</a>
                </li>
              `;
              document.getElementById('prev-page').addEventListener('mouseup', prevPage);
            }
            if(currentPage < Math.ceil(count/8)){
              document.getElementById('pagination-bottom').innerHTML += `
                <li>
                  <a class="pagination-btn" id="next-page">Next</a>
                </li>
              `;
              document.getElementById('next-page').addEventListener('mouseup', nextPage);
            }
            
          }
        }
      }


    function nextPage(event){
      const newPage = parseInt(document.getElementById('page-num').innerHTML) + 1;
      document.getElementById('page-num').innerHTML = `${newPage}`;
      render(pPage, newPage);
    }
    function prevPage(event){
      const newPage = parseInt(document.getElementById('page-num').innerHTML) - 1;
      document.getElementById('page-num').innerHTML = `${newPage}`;
      if(newPage === 1){
        render(pPage);
      } else {
        render(pPage, newPage);
      }
    }
    function render(pPage, targetPage = null){
          switch(pPage){
            case "projects":
              getProjects(db, targetPage);
              break;
            case "websites":
              getWebsites(db);
              break;
            case "software":
              getSoftware(db);
              break;
            case "images":
              getMedia(db);
              break;
          }
    }

    render(pPage);
  </script>

    <!--[if lt IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-target=".bs-docs-sidebar">

    <script>
      let page = getPage();
      const config = build_config(siteConfig, 
      'Blazed Project Management (PM) and project tracking site: Portfolio.', 
      page);
      let pageData = build_routes(page);
      const blz_app = new Fire(config);
      create_app(blz_app.config, pageData);
    </script>


    <script src="assets/js/jquery-1.8.2.min.js"></script>
    <script src="assets/js/jquery.easing.1.3.js"></script>
    <script src="assets/js/google-code-prettify/prettify.js"></script>
    <script src="assets/js/modernizr.js"></script>
    <script src="assets/js/bootstrap.js"></script>
    <script src="assets/js/jquery.elastislide.js"></script>
    <script src="assets/js/application.js"></script>
    <script src="assets/js/jquery.prettyPhoto.js"></script>
    <script src="assets/js/portfolio/jquery.quicksand.js"></script>
    <script src="assets/js/portfolio/setting.js"></script>
    <script src="assets/js/hover/jquery-hover-effect.js"></script>
    <script src="assets/js/hover/setting.js"></script>


    <!-- Template Custom JavaScript File -->
    <script src="assets/js/custom.js"></script>

    <noscript>
      <h1>Uh-Oh!</h1>
      <p>
        Please enable JavaScript for the best browsing experience.
      </p>
    </noscript>

  </body>

</html>
